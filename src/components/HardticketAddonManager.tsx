import React, { useState, useEffect } from 'react';
import { Package, DollarSign, Settings, Globe, Truck, Plus, Edit, Trash2, Eye, CheckCircle, AlertTriangle, Save, RefreshCw, ShoppingCart, Store } from 'lucide-react';
import type { HardticketAddon, ShippingMethod } from '../types';

interface HardticketAddonManagerProps {
  userSubscription: 'basic' | 'advanced' | 'premium' | 'enterprise';
  onAddonUpdate?: (addon: HardticketAddon) => void;
}

const HardticketAddonManager: React.FC<HardticketAddonManagerProps> = ({
  userSubscription = 'basic',
  onAddonUpdate
}) => {
  const [hardticketAddon, setHardticketAddon] = useState<HardticketAddon>({
    id: '1',
    name: 'Hardticket-Versand',
    description: 'Erhalten Sie Ihre Tickets als hochwertige gedruckte Hardtickets per Post',
    price: 4.99,
    isEnabled: false,
    shippingMethods: ['dhl_standard', 'dhl_express', 'deutsche_post'],
    availableCountries: ['DE', 'AT', 'CH'],
    estimatedDeliveryDays: 3,
    maxTicketsPerOrder: 10,
    createdAt: '2024-01-01T00:00:00Z',
    updatedAt: '2024-01-20T10:30:00Z'
  });

  const [isCreatingProduct, setIsCreatingProduct] = useState(false);
  const [showAdvancedSettings, setShowAdvancedSettings] = useState(false);
  const [productCreationStatus, setProductCreationStatus] = useState<'idle' | 'creating' | 'success' | 'error'>('idle');

  // Verf√ºgbare Versandmethoden nach Land
  const shippingMethodsByCountry = {
    'DE': [
      { id: 'dhl_standard', name: 'DHL Standard (2-3 Werktage)', price: 4.99 },
      { id: 'dhl_express', name: 'DHL Express (1-2 Werktage)', price: 9.99 },
      { id: 'deutsche_post', name: 'Deutsche Post Brief (3-5 Werktage)', price: 1.85 }
    ],
    'AT': [
      { id: 'osterreichische_post', name: '√ñsterreichische Post (2-4 Werktage)', price: 3.90 },
      { id: 'dhl_austria', name: 'DHL Austria Express (1-2 Werktage)', price: 12.90 }
    ],
    'CH': [
      { id: 'swiss_post', name: 'Swiss Post (3-5 Werktage)', price: 8.50 },
      { id: 'dhl_swiss', name: 'DHL Swiss Express (1-2 Werktage)', price: 15.90 }
    ],
    'US': [
      { id: 'usps_first_class', name: 'USPS First-Class (3-5 days)', price: 3.50 },
      { id: 'usps_priority', name: 'USPS Priority (1-3 days)', price: 8.95 },
      { id: 'ups_ground', name: 'UPS Ground (1-5 days)', price: 12.50 }
    ],
    'GB': [
      { id: 'royal_mail_first', name: 'Royal Mail First Class (1-2 days)', price: 2.20 },
      { id: 'royal_mail_tracked', name: 'Royal Mail Tracked 24 (1 day)', price: 4.20 },
      { id: 'dpd_uk', name: 'DPD Next Day (1 day)', price: 8.50 }
    ],
    'FR': [
      { id: 'la_poste_colissimo', name: 'Colissimo (2-3 jours)', price: 6.90 },
      { id: 'chronopost', name: 'Chronopost (1 jour)', price: 15.50 }
    ]
  };

  const availableCountries = [
    { code: 'DE', name: 'Deutschland', flag: 'üá©üá™' },
    { code: 'AT', name: '√ñsterreich', flag: 'üá¶üáπ' },
    { code: 'CH', name: 'Schweiz', flag: 'üá®üá≠' },
    { code: 'US', name: 'USA', flag: 'üá∫üá∏' },
    { code: 'GB', name: 'Vereinigtes K√∂nigreich', flag: 'üá¨üáß' },
    { code: 'FR', name: 'Frankreich', flag: 'üá´üá∑' },
    { code: 'IT', name: 'Italien', flag: 'üáÆüáπ' },
    { code: 'ES', name: 'Spanien', flag: 'üá™üá∏' },
    { code: 'NL', name: 'Niederlande', flag: 'üá≥üá±' }
  ];

  // Feature-Verf√ºgbarkeit nach Subscription
  const getSubscriptionFeatures = () => {
    switch (userSubscription) {
      case 'basic':
        return {
          canEnableHardtickets: false,
          maxCountries: 0,
          customPricing: false,
          description: 'Hardticket-Versand nicht verf√ºgbar'
        };
      case 'advanced':
        return {
          canEnableHardtickets: true,
          maxCountries: 3,
          customPricing: true,
          description: 'Hardticket-Versand f√ºr DACH-Region'
        };
      case 'premium':
        return {
          canEnableHardtickets: true,
          maxCountries: 6,
          customPricing: true,
          description: 'Hardticket-Versand f√ºr Europa + USA'
        };
      case 'enterprise':
        return {
          canEnableHardtickets: true,
          maxCountries: -1,
          customPricing: true,
          description: 'Hardticket-Versand weltweit'
        };
      default:
        return {
          canEnableHardtickets: false,
          maxCountries: 0,
          customPricing: false,
          description: 'Feature nicht verf√ºgbar'
        };
    }
  };

  const features = getSubscriptionFeatures();

  // Shopify-Produkt f√ºr Hardticket-Addon erstellen
  const createShopifyProduct = async () => {
    if (!features.canEnableHardtickets) {
      alert('‚ö†Ô∏è Hardticket-Versand ist in Ihrem Plan nicht verf√ºgbar. Upgrade auf Advanced+ erforderlich.');
      return;
    }

    setIsCreatingProduct(true);
    setProductCreationStatus('creating');

    try {
      // Simuliere Shopify Admin API Call
      const productData = {
        product: {
          title: hardticketAddon.name,
          body_html: `<p>${hardticketAddon.description}</p>
            <h3>üé´ Was ist enthalten:</h3>
            <ul>
              <li>‚úÖ Hochwertige gedruckte Tickets</li>
              <li>‚úÖ Sichere Verpackung</li>
              <li>‚úÖ Tracking-Nummer inklusive</li>
              <li>‚úÖ Versicherter Versand</li>
              <li>‚úÖ Lieferung in ${hardticketAddon.estimatedDeliveryDays} Werktagen</li>
            </ul>
            <h3>üì¶ Verf√ºgbare L√§nder:</h3>
            <p>${hardticketAddon.availableCountries.map(code => 
              availableCountries.find(c => c.code === code)?.name
            ).join(', ')}</p>`,
          vendor: 'TicketForge',
          product_type: 'Service',
          tags: 'hardticket,versand,addon,service',
          published: hardticketAddon.isEnabled,
          variants: [
            {
              title: 'Hardticket-Versand',
              price: hardticketAddon.price.toFixed(2),
              sku: `HARDTICKET-ADDON-${hardticketAddon.id}`,
              inventory_management: 'shopify',
              inventory_policy: 'continue',
              inventory_quantity: 9999,
              weight: 0.1,
              weight_unit: 'kg',
              requires_shipping: true,
              taxable: true
            }
          ],
          options: [
            {
              name: 'Service',
              values: ['Hardticket-Versand']
            }
          ],
          metafields: [
            {
              namespace: 'ticketforge',
              key: 'addon_type',
              value: 'hardticket_shipping',
              type: 'single_line_text_field'
            },
            {
              namespace: 'ticketforge',
              key: 'max_tickets_per_order',
              value: hardticketAddon.maxTicketsPerOrder.toString(),
              type: 'number_integer'
            },
            {
              namespace: 'ticketforge',
              key: 'available_countries',
              value: hardticketAddon.availableCountries.join(','),
              type: 'single_line_text_field'
            },
            {
              namespace: 'ticketforge',
              key: 'estimated_delivery_days',
              value: hardticketAddon.estimatedDeliveryDays.toString(),
              type: 'number_integer'
            }
          ]
        }
      };

      console.log('üõçÔ∏è Erstelle Shopify Hardticket-Addon Produkt:', productData);

      // Simuliere API-Antwort
      await new Promise(resolve => setTimeout(resolve, 2000));

      const mockShopifyResponse = {
        product: {
          id: 8765432109876,
          title: hardticketAddon.name,
          handle: 'hardticket-versand-addon',
          variants: [
            {
              id: 45678901234567,
              title: 'Hardticket-Versand',
              price: hardticketAddon.price.toFixed(2),
              sku: `HARDTICKET-ADDON-${hardticketAddon.id}`
            }
          ]
        }
      };

      // Update addon with Shopify IDs
      const updatedAddon = {
        ...hardticketAddon,
        shopifyProductId: mockShopifyResponse.product.id.toString(),
        shopifyVariantId: mockShopifyResponse.product.variants[0].id.toString(),
        updatedAt: new Date().toISOString()
      };

      setHardticketAddon(updatedAddon);
      setProductCreationStatus('success');
      onAddonUpdate?.(updatedAddon);

      alert(`‚úÖ Hardticket-Addon erfolgreich als Shopify-Produkt erstellt!

üõçÔ∏è Shopify-Produkt:
‚Ä¢ Produkt-ID: ${mockShopifyResponse.product.id}
‚Ä¢ Varianten-ID: ${mockShopifyResponse.product.variants[0].id}
‚Ä¢ Handle: ${mockShopifyResponse.product.handle}
‚Ä¢ Preis: ‚Ç¨${hardticketAddon.price}

üì¶ Addon-Details:
‚Ä¢ Name: ${hardticketAddon.name}
‚Ä¢ Beschreibung: ${hardticketAddon.description}
‚Ä¢ Verf√ºgbare L√§nder: ${hardticketAddon.availableCountries.length}
‚Ä¢ Max. Tickets: ${hardticketAddon.maxTicketsPerOrder}
‚Ä¢ Lieferzeit: ${hardticketAddon.estimatedDeliveryDays} Werktage

üîÑ Integration:
‚Ä¢ Automatisch bei Event-Checkout verf√ºgbar
‚Ä¢ Versandkosten werden automatisch berechnet
‚Ä¢ Tracking-Integration aktiviert
‚Ä¢ Kunden-Benachrichtigungen eingerichtet

üõí Das Hardticket-Addon ist jetzt in Ihrem Shopify-Store verf√ºgbar!`);

    } catch (error) {
      setProductCreationStatus('error');
      console.error('‚ùå Fehler beim Erstellen des Shopify-Produkts:', error);
      alert('‚ùå Fehler beim Erstellen des Shopify-Produkts. Bitte versuchen Sie es erneut.');
    } finally {
      setIsCreatingProduct(false);
    }
  };

  // Shopify-Produkt aktualisieren
  const updateShopifyProduct = async () => {
    if (!hardticketAddon.shopifyProductId) {
      alert('‚ùå Kein Shopify-Produkt verkn√ºpft. Bitte erstellen Sie zuerst das Produkt.');
      return;
    }

    try {
      // Simuliere Shopify Product Update API Call
      const updateData = {
        product: {
          id: hardticketAddon.shopifyProductId,
          title: hardticketAddon.name,
          body_html: `<p>${hardticketAddon.description}</p>`,
          published: hardticketAddon.isEnabled,
          variants: [
            {
              id: hardticketAddon.shopifyVariantId,
              price: hardticketAddon.price.toFixed(2)
            }
          ]
        }
      };

      console.log('üõçÔ∏è Aktualisiere Shopify Hardticket-Produkt:', updateData);
      
      await new Promise(resolve => setTimeout(resolve, 1000));

      alert(`‚úÖ Shopify-Produkt erfolgreich aktualisiert!

üõçÔ∏è √Ñnderungen:
‚Ä¢ Preis: ‚Ç¨${hardticketAddon.price}
‚Ä¢ Status: ${hardticketAddon.isEnabled ? 'Aktiv' : 'Inaktiv'}
‚Ä¢ Verf√ºgbare L√§nder: ${hardticketAddon.availableCountries.length}

üîÑ Die √Ñnderungen sind sofort in Ihrem Shopify-Store sichtbar.`);

    } catch (error) {
      console.error('‚ùå Fehler beim Aktualisieren des Shopify-Produkts:', error);
      alert('‚ùå Fehler beim Aktualisieren des Shopify-Produkts.');
    }
  };

  // Addon-Einstellungen aktualisieren
  const updateAddonSetting = (key: keyof HardticketAddon, value: any) => {
    setHardticketAddon(prev => ({
      ...prev,
      [key]: value,
      updatedAt: new Date().toISOString()
    }));
  };

  // Land zur Verf√ºgbarkeitsliste hinzuf√ºgen/entfernen
  const toggleCountryAvailability = (countryCode: string) => {
    const currentCountries = hardticketAddon.availableCountries;
    const newCountries = currentCountries.includes(countryCode)
      ? currentCountries.filter(code => code !== countryCode)
      : [...currentCountries, countryCode];

    // Pr√ºfe Subscription-Limits
    if (features.maxCountries !== -1 && newCountries.length > features.maxCountries) {
      alert(`‚ö†Ô∏è Ihr ${userSubscription} Plan unterst√ºtzt maximal ${features.maxCountries} L√§nder. Upgrade f√ºr mehr L√§nder erforderlich.`);
      return;
    }

    updateAddonSetting('availableCountries', newCountries);
  };

  // Versandmethode hinzuf√ºgen/entfernen
  const toggleShippingMethod = (methodId: string) => {
    const currentMethods = hardticketAddon.shippingMethods;
    const newMethods = currentMethods.includes(methodId)
      ? currentMethods.filter(id => id !== methodId)
      : [...currentMethods, methodId];

    updateAddonSetting('shippingMethods', newMethods);
  };

  // Addon aktivieren/deaktivieren
  const toggleAddonStatus = async () => {
    if (!features.canEnableHardtickets) {
      alert(`‚ö†Ô∏è Hardticket-Versand ist in Ihrem ${userSubscription} Plan nicht verf√ºgbar.

üöÄ Upgrade-Optionen:
‚Ä¢ Advanced Plan: ‚Ç¨99/Monat - DACH-Region (DE, AT, CH)
‚Ä¢ Premium Plan: ‚Ç¨299/Monat - Europa + USA
‚Ä¢ Enterprise Plan: ‚Ç¨599/Monat - Weltweit

üìû Upgrade: sales@ticketforge.com`);
      return;
    }

    const newStatus = !hardticketAddon.isEnabled;
    updateAddonSetting('isEnabled', newStatus);

    if (newStatus && hardticketAddon.shopifyProductId) {
      await updateShopifyProduct();
    }

    alert(`${newStatus ? '‚úÖ' : '‚ùå'} Hardticket-Addon ${newStatus ? 'aktiviert' : 'deaktiviert'}!

${newStatus ? `üõí Kunden k√∂nnen jetzt Hardtickets f√ºr ‚Ç¨${hardticketAddon.price} bestellen.` : 'üö´ Hardticket-Option ist nicht mehr verf√ºgbar.'}

üîÑ Shopify-Produkt wurde entsprechend ${newStatus ? 'ver√∂ffentlicht' : 'versteckt'}.`);
  };

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h3 className="text-2xl font-bold text-gray-900 flex items-center space-x-2">
            <Package className="w-7 h-7 text-purple-600" />
            <span>üé´ Hardticket-Addon Verwaltung</span>
          </h3>
          <p className="text-gray-600 mt-1">Konfigurieren Sie kostenpflichtige Hardticket-Versand-Optionen</p>
        </div>
        <div className="flex items-center space-x-3">
          <div className={`px-3 py-2 rounded-lg text-sm font-medium ${
            userSubscription === 'basic' ? 'bg-red-100 text-red-800' :
            userSubscription === 'advanced' ? 'bg-emerald-100 text-emerald-800' :
            userSubscription === 'premium' ? 'bg-purple-100 text-purple-800' :
            'bg-orange-100 text-orange-800'
          }`}>
            {userSubscription.charAt(0).toUpperCase() + userSubscription.slice(1)} Plan
          </div>
          <button
            onClick={() => setShowAdvancedSettings(!showAdvancedSettings)}
            className="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors flex items-center space-x-2"
          >
            <Settings className="w-4 h-4" />
            <span>‚öôÔ∏è Erweitert</span>
          </button>
        </div>
      </div>

      {/* Subscription Features Info */}
      <div className="bg-white rounded-xl p-6 border border-gray-200">
        <h4 className="text-lg font-semibold text-gray-900 mb-4">üìã Plan-Features</h4>
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
          <div className="text-center">
            <div className={`text-2xl font-bold ${features.canEnableHardtickets ? 'text-emerald-600' : 'text-red-600'}`}>
              {features.canEnableHardtickets ? '‚úÖ' : '‚ùå'}
            </div>
            <div className="text-sm text-gray-600">Hardticket-Versand</div>
          </div>
          <div className="text-center">
            <div className="text-2xl font-bold text-blue-600">
              {features.maxCountries === -1 ? '‚àû' : features.maxCountries}
            </div>
            <div className="text-sm text-gray-600">Verf√ºgbare L√§nder</div>
          </div>
          <div className="text-center">
            <div className={`text-2xl font-bold ${features.customPricing ? 'text-emerald-600' : 'text-red-600'}`}>
              {features.customPricing ? '‚úÖ' : '‚ùå'}
            </div>
            <div className="text-sm text-gray-600">Custom Preise</div>
          </div>
          <div className="text-center">
            <div className={`text-2xl font-bold ${hardticketAddon.isEnabled ? 'text-emerald-600' : 'text-red-600'}`}>
              {hardticketAddon.isEnabled ? 'üü¢' : 'üî¥'}
            </div>
            <div className="text-sm text-gray-600">Aktueller Status</div>
          </div>
        </div>
        <div className="mt-4 p-3 bg-blue-50 rounded-lg">
          <p className="text-blue-800 text-sm">{features.description}</p>
        </div>
      </div>

      {/* Hardticket-Addon Konfiguration */}
      <div className="bg-white rounded-xl p-6 border border-gray-200">
        <h4 className="text-lg font-semibold text-gray-900 mb-6">üé´ Hardticket-Addon Einstellungen</h4>
        
        <div className="space-y-6">
          {/* Basis-Einstellungen */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Addon-Name</label>
              <input
                type="text"
                value={hardticketAddon.name}
                onChange={(e) => updateAddonSetting('name', e.target.value)}
                disabled={!features.canEnableHardtickets}
                className={`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ${
                  !features.canEnableHardtickets ? 'bg-gray-50 text-gray-400' : ''
                }`}
              />
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Preis (‚Ç¨) {!features.customPricing && '(Premium Feature)'}
              </label>
              <input
                type="number"
                min="0"
                step="0.01"
                value={hardticketAddon.price}
                onChange={(e) => updateAddonSetting('price', parseFloat(e.target.value) || 0)}
                disabled={!features.customPricing}
                className={`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ${
                  !features.customPricing ? 'bg-gray-50 text-gray-400' : ''
                }`}
              />
              {!features.customPricing && (
                <p className="text-xs text-red-500 mt-1">‚ö†Ô∏è Custom Preise nur ab Advanced Plan</p>
              )}
            </div>
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Beschreibung</label>
            <textarea
              value={hardticketAddon.description}
              onChange={(e) => updateAddonSetting('description', e.target.value)}
              disabled={!features.canEnableHardtickets}
              rows={3}
              className={`w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent ${
                !features.canEnableHardtickets ? 'bg-gray-50 text-gray-400' : ''
              }`}
            />
          </div>

          {/* Verf√ºgbare L√§nder */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-3">
              üåç Verf√ºgbare L√§nder {features.maxCountries !== -1 && `(Max. ${features.maxCountries})`}
            </label>
            <div className="grid grid-cols-3 md:grid-cols-6 gap-3">
              {availableCountries.map(country => {
                const isSelected = hardticketAddon.availableCountries.includes(country.code);
                const canSelect = features.canEnableHardtickets && 
                  (isSelected || features.maxCountries === -1 || hardticketAddon.availableCountries.length < features.maxCountries);
                
                return (
                  <label 
                    key={country.code} 
                    className={`flex items-center space-x-2 p-3 border rounded-lg cursor-pointer transition-colors ${
                      isSelected ? 'border-purple-500 bg-purple-50' : 'border-gray-200 hover:border-gray-300'
                    } ${!canSelect ? 'opacity-50 cursor-not-allowed' : ''}`}
                  >
                    <input
                      type="checkbox"
                      checked={isSelected}
                      onChange={() => canSelect && toggleCountryAvailability(country.code)}
                      disabled={!canSelect}
                      className="rounded border-gray-300 text-purple-600 focus:ring-purple-500"
                    />
                    <div className="text-center">
                      <div className="text-lg">{country.flag}</div>
                      <div className="text-xs text-gray-700">{country.code}</div>
                    </div>
                  </label>
                );
              })}
            </div>
            {!features.canEnableHardtickets && (
              <p className="text-xs text-red-500 mt-2">‚ö†Ô∏è Hardticket-Versand nur ab Advanced Plan verf√ºgbar</p>
            )}
          </div>

          {/* Erweiterte Einstellungen */}
          {showAdvancedSettings && features.canEnableHardtickets && (
            <div className="border-t border-gray-200 pt-6 space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Gesch√§tzte Lieferzeit (Werktage)</label>
                  <input
                    type="number"
                    min="1"
                    max="14"
                    value={hardticketAddon.estimatedDeliveryDays}
                    onChange={(e) => updateAddonSetting('estimatedDeliveryDays', parseInt(e.target.value) || 3)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Max. Tickets pro Bestellung</label>
                  <input
                    type="number"
                    min="1"
                    max="50"
                    value={hardticketAddon.maxTicketsPerOrder}
                    onChange={(e) => updateAddonSetting('maxTicketsPerOrder', parseInt(e.target.value) || 10)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  />
                </div>
              </div>

              {/* Versandmethoden pro Land */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-3">üöö Verf√ºgbare Versandmethoden</label>
                <div className="space-y-4">
                  {hardticketAddon.availableCountries.map(countryCode => {
                    const country = availableCountries.find(c => c.code === countryCode);
                    const methods = shippingMethodsByCountry[countryCode as keyof typeof shippingMethodsByCountry] || [];
                    
                    return (
                      <div key={countryCode} className="border border-gray-200 rounded-lg p-4">
                        <h5 className="font-medium text-gray-900 mb-3">
                          {country?.flag} {country?.name}
                        </h5>
                        <div className="space-y-2">
                          {methods.map(method => (
                            <label key={method.id} className="flex items-center space-x-3">
                              <input
                                type="checkbox"
                                checked={hardticketAddon.shippingMethods.includes(method.id)}
                                onChange={() => toggleShippingMethod(method.id)}
                                className="rounded border-gray-300 text-purple-600 focus:ring-purple-500"
                              />
                              <div className="flex-1">
                                <span className="text-sm font-medium text-gray-900">{method.name}</span>
                                <span className="text-sm text-gray-600 ml-2">‚Ç¨{method.price}</span>
                              </div>
                            </label>
                          ))}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
          )}

          {/* Addon-Status und Shopify-Integration */}
          <div className="border-t border-gray-200 pt-6">
            <div className="flex items-center justify-between">
              <div>
                <h5 className="font-medium text-gray-900 mb-2">üõçÔ∏è Shopify-Integration</h5>
                <div className="space-y-2 text-sm">
                  <div className="flex items-center space-x-2">
                    <span className="text-gray-600">Shopify-Produkt:</span>
                    {hardticketAddon.shopifyProductId ? (
                      <span className="text-emerald-600 font-medium">‚úÖ Verkn√ºpft (ID: {hardticketAddon.shopifyProductId})</span>
                    ) : (
                      <span className="text-red-600 font-medium">‚ùå Nicht erstellt</span>
                    )}
                  </div>
                  <div className="flex items-center space-x-2">
                    <span className="text-gray-600">Status:</span>
                    <span className={`font-medium ${hardticketAddon.isEnabled ? 'text-emerald-600' : 'text-red-600'}`}>
                      {hardticketAddon.isEnabled ? 'üü¢ Aktiv' : 'üî¥ Inaktiv'}
                    </span>
                  </div>
                  <div className="flex items-center space-x-2">
                    <span className="text-gray-600">Verf√ºgbare L√§nder:</span>
                    <span className="text-blue-600 font-medium">{hardticketAddon.availableCountries.length}</span>
                  </div>
                </div>
              </div>
              
              <div className="flex items-center space-x-3">
                <button
                  onClick={toggleAddonStatus}
                  disabled={!features.canEnableHardtickets}
                  className={`px-6 py-2 rounded-lg font-medium transition-colors ${
                    hardticketAddon.isEnabled
                      ? 'bg-red-600 text-white hover:bg-red-700'
                      : 'bg-emerald-600 text-white hover:bg-emerald-700'
                  } ${!features.canEnableHardtickets ? 'opacity-50 cursor-not-allowed' : ''}`}
                >
                  {hardticketAddon.isEnabled ? 'üî¥ Deaktivieren' : 'üü¢ Aktivieren'}
                </button>
                
                {!hardticketAddon.shopifyProductId ? (
                  <button
                    onClick={createShopifyProduct}
                    disabled={!features.canEnableHardtickets || isCreatingProduct}
                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2"
                  >
                    {isCreatingProduct ? (
                      <>
                        <RefreshCw className="w-4 h-4 animate-spin" />
                        <span>Erstelle...</span>
                      </>
                    ) : (
                      <>
                        <Store className="w-4 h-4" />
                        <span>üõçÔ∏è Shopify-Produkt erstellen</span>
                      </>
                    )}
                  </button>
                ) : (
                  <button
                    onClick={updateShopifyProduct}
                    className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2"
                  >
                    <RefreshCw className="w-4 h-4" />
                    <span>üîÑ Shopify aktualisieren</span>
                  </button>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Hardticket-Addon Vorschau */}
      <div className="bg-white rounded-xl p-6 border border-gray-200">
        <h4 className="text-lg font-semibold text-gray-900 mb-4">üëÅÔ∏è Kunden-Vorschau</h4>
        
        <div className="border border-gray-200 rounded-lg p-6 bg-gray-50">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h5 className="text-xl font-bold text-gray-900">{hardticketAddon.name}</h5>
              <p className="text-gray-600">{hardticketAddon.description}</p>
            </div>
            <div className="text-right">
              <div className="text-2xl font-bold text-purple-600">‚Ç¨{hardticketAddon.price}</div>
              <div className="text-sm text-gray-600">pro Bestellung</div>
            </div>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div className="bg-white rounded-lg p-4">
              <h6 className="font-medium text-gray-900 mb-2">üì¶ Lieferung</h6>
              <div className="text-sm text-gray-600 space-y-1">
                <div>‚è∞ {hardticketAddon.estimatedDeliveryDays} Werktage</div>
                <div>üìä Tracking inklusive</div>
                <div>üé´ Max. {hardticketAddon.maxTicketsPerOrder} Tickets</div>
              </div>
            </div>
            
            <div className="bg-white rounded-lg p-4">
              <h6 className="font-medium text-gray-900 mb-2">üåç Verf√ºgbare L√§nder</h6>
              <div className="flex flex-wrap gap-1">
                {hardticketAddon.availableCountries.map(code => {
                  const country = availableCountries.find(c => c.code === code);
                  return (
                    <span key={code} className="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">
                      {country?.flag} {country?.name}
                    </span>
                  );
                })}
              </div>
            </div>
          </div>

          <div className="bg-emerald-50 rounded-lg p-4 border border-emerald-200">
            <h6 className="font-medium text-emerald-900 mb-2">‚ú® Hardticket-Vorteile:</h6>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-emerald-800">
              <div>‚Ä¢ üé´ Hochwertige gedruckte Tickets</div>
              <div>‚Ä¢ üì¶ Sichere Verpackung</div>
              <div>‚Ä¢ üìä QR & UPC-Codes f√ºr Validierung</div>
              <div>‚Ä¢ üöö Versicherter Versand</div>
              <div>‚Ä¢ üìã Lieferschein im Ticket-Format</div>
              <div>‚Ä¢ üì± Live-Tracking verf√ºgbar</div>
            </div>
          </div>

          {hardticketAddon.isEnabled ? (
            <div className="mt-4 p-3 bg-emerald-50 rounded-lg border border-emerald-200">
              <div className="flex items-center space-x-2">
                <CheckCircle className="w-5 h-5 text-emerald-600" />
                <span className="font-medium text-emerald-800">‚úÖ Hardticket-Option ist f√ºr Kunden verf√ºgbar</span>
              </div>
            </div>
          ) : (
            <div className="mt-4 p-3 bg-red-50 rounded-lg border border-red-200">
              <div className="flex items-center space-x-2">
                <AlertTriangle className="w-5 h-5 text-red-600" />
                <span className="font-medium text-red-800">‚ùå Hardticket-Option ist deaktiviert</span>
              </div>
            </div>
          )}
        </div>
      </div>

      {/* Shopify-Produkt Status */}
      {hardticketAddon.shopifyProductId && (
        <div className="bg-white rounded-xl p-6 border border-gray-200">
          <h4 className="text-lg font-semibold text-gray-900 mb-4">üõçÔ∏è Shopify-Produkt Status</h4>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div className="bg-blue-50 rounded-lg p-4">
              <div className="text-lg font-bold text-blue-600">{hardticketAddon.shopifyProductId}</div>
              <div className="text-sm text-blue-800">Shopify Produkt-ID</div>
            </div>
            <div className="bg-emerald-50 rounded-lg p-4">
              <div className="text-lg font-bold text-emerald-600">{hardticketAddon.shopifyVariantId}</div>
              <div className="text-sm text-emerald-800">Shopify Varianten-ID</div>
            </div>
            <div className="bg-purple-50 rounded-lg p-4">
              <div className="text-lg font-bold text-purple-600">‚Ç¨{hardticketAddon.price}</div>
              <div className="text-sm text-purple-800">Aktueller Preis</div>
            </div>
          </div>

          <div className="mt-6 p-4 bg-gray-50 rounded-lg">
            <h6 className="font-medium text-gray-900 mb-2">üîó Shopify-Integration:</h6>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
              <div>‚Ä¢ üõí Automatisch bei Event-Checkout verf√ºgbar</div>
              <div>‚Ä¢ üí∞ Preis wird automatisch berechnet</div>
              <div>‚Ä¢ üì¶ Versandkosten nach Land</div>
              <div>‚Ä¢ üìß Kunden-Benachrichtigungen automatisch</div>
              <div>‚Ä¢ üìä Tracking-Integration aktiviert</div>
              <div>‚Ä¢ üîÑ Inventory-Sync mit TicketForge</div>
            </div>
          </div>
        </div>
      )}

      {/* Upgrade-Hinweis f√ºr Basic Plan */}
      {userSubscription === 'basic' && (
        <div className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-8 border border-purple-200">
          <h4 className="text-2xl font-bold text-gray-900 mb-4">üöÄ Hardticket-Versand freischalten</h4>
          <p className="text-gray-700 mb-6">
            Bieten Sie Ihren Kunden premium Hardtickets mit professionellem Versand an. 
            Steigern Sie Ihren Umsatz mit diesem beliebten Zusatzservice.
          </p>
          
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div className="text-center">
              <div className="text-3xl font-bold text-purple-600">+‚Ç¨4.99</div>
              <div className="text-purple-800">Pro Hardticket-Bestellung</div>
            </div>
            <div className="text-center">
              <div className="text-3xl font-bold text-blue-600">3-5</div>
              <div className="text-blue-800">Werktage Lieferzeit</div>
            </div>
            <div className="text-center">
              <div className="text-3xl font-bold text-emerald-600">9</div>
              <div className="text-emerald-800">L√§nder verf√ºgbar</div>
            </div>
          </div>
          
          <div className="text-center">
            <button 
              onClick={() => {
                alert(`üöÄ Hardticket-Versand freischalten:

üí∞ Plan-Vergleich:
‚Ä¢ Advanced (‚Ç¨99/Monat): DACH-Region (DE, AT, CH)
‚Ä¢ Premium (‚Ç¨299/Monat): Europa + USA (6 L√§nder)
‚Ä¢ Enterprise (‚Ç¨599/Monat): Weltweit (alle L√§nder)

‚ú® Hardticket-Features:
‚Ä¢ üé´ Professionelle gedruckte Tickets
‚Ä¢ üì¶ Automatische Versandetiketten
‚Ä¢ üìã Lieferscheine im Ticket-Format
‚Ä¢ üöö Multi-Carrier-Support (DHL, Post, UPS, etc.)
‚Ä¢ üìä Live-Tracking f√ºr Kunden
‚Ä¢ üí∞ Zus√§tzliche Umsatzquelle

üìà Umsatz-Potential:
‚Ä¢ √ò 15% der Kunden w√§hlen Hardtickets
‚Ä¢ +‚Ç¨4.99 pro Hardticket-Bestellung
‚Ä¢ Bei 100 Tickets/Monat = +‚Ç¨75 Zusatzumsatz

üìû Upgrade jetzt:
‚Ä¢ Online: ticketforge.com/upgrade
‚Ä¢ E-Mail: sales@ticketforge.com
‚Ä¢ Telefon: +49 30 12345678`);
              }}
              className="bg-purple-600 text-white px-8 py-3 rounded-lg hover:bg-purple-700 transition-colors text-lg font-medium"
            >
              üöÄ Jetzt upgraden und Hardtickets aktivieren
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

export default HardticketAddonManager;